<?xml version="1.0" encoding="ISO-8859-1"?>

<PropertyList>

<!-- ELEVATOR -->

  <filter>
    <name>Elevator</name>
    <type>gain</type>
    <update-interval-secs type="double">0.0</update-interval-secs>
    <input>
      <property>/controls/flight/elevator</property>
    </input>
    <enable>
        <condition>
            <or>
                <greater-than>
                    <property>/systems/hydraulic/psi1</property>
                    <value>2900</value>
                </greater-than>
                <greater-than>
                    <property>/systems/hydraulic/psi2</property>
                    <value>2900</value>
                </greater-than>
                <and>
                    <greater-than>
                        <property>/systems/hydraulic/psi3</property>
                        <value>2900</value>
                    </greater-than>
                    <property>/controls/hydraulic/isol-valve3</property>
                </and>
            </or>
        </condition>
    </enable>
    <gain>1</gain>
    <output>controls/flight/elevator-int</output>
  </filter>

<!-- RUDDER -->

  <filter>
    <name>Rudder</name>
    <type>gain</type>
    <update-interval-secs type="double">0.0</update-interval-secs>
    <input>
      <property>/controls/flight/rudder-cmd</property>
    </input>
    <enable>
        <condition>
            <or>
                <greater-than>
                    <property>/systems/hydraulic/psi1</property>
                    <value>2900</value>
                </greater-than>
                <greater-than>
                    <property>/systems/hydraulic/psi2</property>
                    <value>2900</value>
                </greater-than>
            </or>
        </condition>
    </enable>
    <gain>1</gain>
    <output>controls/flight/rudder-int</output>
  </filter>

<!-- NOSE WHEEL STEERING -->

  <filter>
    <name>Nose Wheel Steering</name>
    <type>gain</type>
    <update-interval-secs type="double">0.0</update-interval-secs>
    <input>
      <property>/controls/flight/rudder</property>
    </input>
    <enable>
        <condition>
		<or>
			<greater-than>
				<property>/systems/hydraulic/psi2</property>
				<value>2900</value>
			</greater-than>
			<equals>
				<property>/sim/model/pushback/position-norm</property>
				<value>1</value>
			</equals>
		</or>
        </condition>
    </enable>
    <gain>1</gain>
    <output>controls/gear/nose-steering-int</output>
  </filter>
  
	<!--Power Lever Control Lock-->
	<filter>
		<name>Power Lever Control Left</name>
		<type>gain</type>
		<update-interval-secs type="double">0.0</update-interval-secs>
		<input>
			<expression>
				<prod>
					<property>/controls/engines/engine[0]/throttle</property>
					<table>
						<property>/controls/engines/throttle-lock-position</property>
						<entry><ind> 0.0</ind><dep> 1</dep></entry>
						<entry><ind> 1.0</ind><dep> 0.15</dep></entry>
					</table>
				</prod>
			</expression>
			<condition>
				<not>
					<property>/engines/engine[0]/reversed</property>				
				</not>
			</condition>
		</input>
		<input>
			<property>/controls/engines/engine[0]/throttle</property>
			<condition>
				<property>/engines/engine[0]/reversed</property>
			</condition>
		</input>
		<gain>1.0</gain>
		<output>controls/engines/engine[0]/throttle-int</output>
	</filter>
	<filter>
		<name>Power Lever Control Right</name>
		<type>gain</type>
		<update-interval-secs type="double">0.0</update-interval-secs>
		<input>
			<expression>
				<prod>
					<property>/controls/engines/engine[1]/throttle</property>
					<table>
						<property>/controls/engines/throttle-lock-position</property>
						<entry><ind> 0.0</ind><dep> 1</dep></entry>
						<entry><ind> 1.0</ind><dep> 0.15</dep></entry>
					</table>
				</prod>
			</expression>
			<condition>
				<not>
					<property>/engines/engine[1]/reversed</property>				
				</not>
			</condition>
		</input>
		<input>
			<property>/controls/engines/engine[1]/throttle</property>
			<condition>
				<property>/engines/engine[1]/reversed</property>
			</condition>
		</input>
		<gain>1.0</gain>
		<output>controls/engines/engine[1]/throttle-int</output>
	</filter>
  
  
  <!--THRUST DETENT MODES-->
  
  <!--EMERGENCY POWER-->
  <!--Condition: Thrust lever in Overtravel-->
  <!--Throttle command: 1.0 (1.25*MTOP)-->
  <!--sets propeller speed to 1020 RPM-->
  <filter>
    <name>EMERGENCY POWER L</name>
    <type>gain</type>
    <update-interval-secs type="double">0.0</update-interval-secs>
    <input>
	<expression>
			<table>
				<property>/controls/engines/engine[0]/throttle-int</property>
				<entry><ind> 0.8</ind><dep> 0.8</dep></entry>
				<entry><ind> 1</ind><dep> 1</dep></entry>
			</table>
	</expression>
    </input>
    <enable>
        <condition>
		<greater-than>
			<property>/controls/engines/engine[0]/throttle-int</property>
			<value>0.8</value>
		</greater-than>
		<not>
			<property>/engines/engine[0]/reversed</property>
		</not>
        </condition>
    </enable>
    <gain>1.0</gain>
	<output>fcs/throttle-cmd-norm[0]</output>
	<output>fcs/throttle-pos-norm[0]</output>
  </filter>
  
  
  <!--from FLIGHT IDLE to THRUST DETENT POSITION (0.8)-->
  
  <!--MTOP: Maximum Takeoff Power-->
  <!--Condition: condition lever in START&FEATHER or MAX 1020 position and MTOP discrete activated (button)-->
  <!--Throttle command: 0.8 (emergency power is at 1.25*MTOP)-->
  <filter>
    <name>MTOP Thrust detent L</name>
    <type>gain</type>
    <update-interval-secs type="double">0.0</update-interval-secs>
    <input>
	<expression>
			<table>
				<property>/controls/engines/engine[0]/throttle-int</property>
				<entry><ind> 0 </ind><dep> 0.0</dep></entry>
				<entry><ind> 0.7</ind><dep> 1</dep></entry>
				<entry><ind> 0.8</ind><dep> 1</dep></entry>
			</table>
	</expression>
    </input>
    <enable>
        <condition>
		<and>
			<or>
				<equals>
					<property>/controls/engines/engine[0]/condition-lever-state</property>
					<value>1</value>
				</equals>
				<equals>
					<property>/controls/engines/engine[0]/condition-lever-state</property>
					<value>4</value>
				</equals>
			</or>
			<property>/controls/engines/mtop-discrete</property>
			<less-than-equals>
				<property>/controls/engines/engine[0]/throttle-int</property>
				<value>0.8</value>
			</less-than-equals>
		</and>
        </condition>
    </enable>
    <gain>0.8</gain>
	<output>fcs/throttle-cmd-norm[0]</output>
	<output>fcs/throttle-pos-norm[0]</output>
  </filter>
  
  <!--NTOP: Normal Takeoff Power-->
  <!--Condition: condition lever in START&FEATHER or MAX 1020 position-->
  <!--Throttle command: 0.72 (pure guess based on figure 12.23-4 in http://www.smartcockpit.com/docs/Q400-Power_Plant.pdf-->
  <filter>
    <name>NTOP Thrust detent L</name>
    <type>gain</type>
    <update-interval-secs type="double">0.0</update-interval-secs>
    <input>
	<expression>
			<table>
				<property>/controls/engines/engine[0]/throttle-int</property>
				<entry><ind> 0 </ind><dep> 0.0</dep></entry>
				<entry><ind> 0.7</ind><dep> 1</dep></entry>
				<entry><ind> 0.8</ind><dep> 1</dep></entry>
			</table>
	</expression>
    </input>
    <enable>
        <condition>
		<and>
			<or>
				<equals>
					<property>/controls/engines/engine[0]/condition-lever-state</property>
					<value>1</value>
				</equals>
				<equals>
					<property>/controls/engines/engine[0]/condition-lever-state</property>
					<value>4</value>
				</equals>
			</or>
			<less-than-equals>
				<property>/controls/engines/engine[0]/throttle-int</property>
				<value>0.8</value>
			</less-than-equals>
		</and>
        </condition>
    </enable>
    <gain>0.72</gain>
	<output>fcs/throttle-cmd-norm[0]</output>
	<output>fcs/throttle-pos-norm[0]</output>
  </filter>
  
  <!--MCL: Maximum Climb Power-->
  <!--Condition: Condition Lever in 900 RPM position-->
  <!--Throttle command: 0.65 (pure guess based on figure 12.23-4 in http://www.smartcockpit.com/docs/Q400-Power_Plant.pdf-->
  <filter>
    <name>MCL Thrust detent L</name>
    <type>gain</type>
    <update-interval-secs type="double">0.0</update-interval-secs>
    <input>
	<expression>
			<table>
				<property>/controls/engines/engine[0]/throttle-int</property>
				<entry><ind> 0 </ind><dep> 0.0</dep></entry>
				<entry><ind> 0.7</ind><dep> 1</dep></entry>
				<entry><ind> 0.8</ind><dep> 1</dep></entry>
			</table>
	</expression>
    </input>
    <enable>
        <condition>
		<and>
			<equals>
				<property>/controls/engines/engine[0]/condition-lever-state</property>
				<value>3</value>
			</equals>
			<less-than-equals>
				<property>/controls/engines/engine[0]/throttle-int</property>
				<value>0.8</value>
			</less-than-equals>
		</and>
        </condition>
    </enable>
    <gain>0.65</gain>
	<output>fcs/throttle-cmd-norm[0]</output>
	<output>fcs/throttle-pos-norm[0]</output>
  </filter>
  
  <!--MCR: Maximum Cruise Power-->
  <!--Condition: Condition Lever in MIN 850 RPM position-->
  <!--Throttle command: 0.62 (pure guess based on figure 12.23-4 in http://www.smartcockpit.com/docs/Q400-Power_Plant.pdf-->
  <filter>
    <name>MCR Thrust detent L</name>
    <type>gain</type>
    <update-interval-secs type="double">0.0</update-interval-secs>
    <input>
	<expression>
			<table>
				<property>/controls/engines/engine[0]/throttle-int</property>
				<entry><ind> 0 </ind><dep> 0.0</dep></entry>
				<entry><ind> 0.7</ind><dep> 1</dep></entry>
				<entry><ind> 0.8</ind><dep> 1</dep></entry>
			</table>
	</expression>
    </input>
    <enable>
        <condition>
		<and>
			<equals>
				<property>/controls/engines/engine[0]/condition-lever-state</property>
				<value>2</value>
			</equals>
			<less-than-equals>
				<property>/controls/engines/engine[0]/throttle-int</property>
				<value>0.8</value>
			</less-than-equals>
		</and>
        </condition>
    </enable>
    <gain>0.62</gain>
	<output>fcs/throttle-cmd-norm[0]</output>
	<output>fcs/throttle-pos-norm[0]</output>
  </filter>
  
  <!--FUEL CUTOFF: no power at all-->
  
  <filter>
    <name>CUTOFF L</name>
    <type>gain</type>
    <update-interval-secs type="double">0.0</update-interval-secs>
    <input>
	    <value>0</value>
    </input>
    <enable>
        <condition>
		<equals>
			<property>/controls/engines/engine[0]/condition-lever-state</property>
			<value>0</value>
		</equals>
        </condition>
    </enable>
    <gain>1</gain>
	<output>fcs/throttle-cmd-norm[0]</output>
	<output>fcs/throttle-pos-norm[0]</output>
  </filter>
  
  <!--Engine 2-->
  
  <!--EMERGENCY POWER-->
  <!--Condition: Thrust lever in Overtravel-->
  <!--Throttle command: 1.0 (1.25*MTOP)-->
  <!--sets propeller speed to 1020 RPM-->
  <filter>
    <name>EMERGENCY POWER R</name>
    <type>gain</type>
    <update-interval-secs type="double">0.0</update-interval-secs>
    <input>
	<expression>
			<table>
				<property>/controls/engines/engine[1]/throttle-int</property>
				<entry><ind> 0.8</ind><dep> 0.8</dep></entry>
				<entry><ind> 1</ind><dep> 1</dep></entry>
			</table>
	</expression>
    </input>
    <enable>
        <condition>
		<greater-than>
			<property>/controls/engines/engine[1]/throttle-int</property>
			<value>0.8</value>
		</greater-than>
		<not>
			<property>/engines/engine[0]/reversed</property>
		</not>
        </condition>
    </enable>
    <gain>1.0</gain>
	<output>fcs/throttle-cmd-norm[1]</output>
	<output>fcs/throttle-pos-norm[1]</output>
  </filter>
  
  
  <!--from FLIGHT IDLE to THRUST DETENT POSITION (0.8)-->
  
  <!--MTOP: Maximum Takeoff Power-->
  <!--Condition: condition lever in START&FEATHER or MAX 1020 position and MTOP discrete activated (button)-->
  <!--Throttle command: 0.8 (emergency power is at 1.25*MTOP)-->
  <filter>
    <name>MTOP Thrust detent R</name>
    <type>gain</type>
    <update-interval-secs type="double">0.0</update-interval-secs>
    <input>
	<expression>
			<table>
				<property>/controls/engines/engine[1]/throttle-int</property>
				<entry><ind> 0 </ind><dep> 0.0</dep></entry>
				<entry><ind> 0.7</ind><dep> 1</dep></entry>
				<entry><ind> 0.8</ind><dep> 1</dep></entry>
			</table>
	</expression>
    </input>
    <enable>
        <condition>
		<and>
			<or>
				<equals>
					<property>/controls/engines/engine[1]/condition-lever-state</property>
					<value>1</value>
				</equals>
				<equals>
					<property>/controls/engines/engine[1]/condition-lever-state</property>
					<value>4</value>
				</equals>
			</or>
			<property>/controls/engines/mtop-discrete</property>
			<less-than-equals>
				<property>/controls/engines/engine[1]/throttle-int</property>
				<value>0.8</value>
			</less-than-equals>
		</and>
        </condition>
    </enable>
    <gain>0.8</gain>
	<output>fcs/throttle-cmd-norm[1]</output>
	<output>fcs/throttle-pos-norm[1]</output>
  </filter>
  
  <!--NTOP: Normal Takeoff Power-->
  <!--Condition: condition lever in START&FEATHER or MAX 1020 position-->
  <!--Throttle command: 0.72 (pure guess based on figure 12.23-4 in http://www.smartcockpit.com/docs/Q400-Power_Plant.pdf-->
  <filter>
    <name>NTOP Thrust detent R</name>
    <type>gain</type>
    <update-interval-secs type="double">0.0</update-interval-secs>
    <input>
	<expression>
			<table>
				<property>/controls/engines/engine[1]/throttle-int</property>
				<entry><ind> 0 </ind><dep> 0.0</dep></entry>
				<entry><ind> 0.7</ind><dep> 1</dep></entry>
				<entry><ind> 0.8</ind><dep> 1</dep></entry>
			</table>
	</expression>
    </input>
    <enable>
        <condition>
		<and>
			<or>
				<equals>
					<property>/controls/engines/engine[1]/condition-lever-state</property>
					<value>1</value>
				</equals>
				<equals>
					<property>/controls/engines/engine[1]/condition-lever-state</property>
					<value>4</value>
				</equals>
			</or>
			<less-than-equals>
				<property>/controls/engines/engine[1]/throttle-int</property>
				<value>0.8</value>
			</less-than-equals>
		</and>
        </condition>
    </enable>
    <gain>0.72</gain>
	<output>fcs/throttle-cmd-norm[1]</output>
	<output>fcs/throttle-pos-norm[1]</output>
  </filter>
  
  <!--MCL: Maximum Climb Power-->
  <!--Condition: Condition Lever in 900 RPM position-->
  <!--Throttle command: 0.65 (pure guess based on figure 12.23-4 in http://www.smartcockpit.com/docs/Q400-Power_Plant.pdf-->
  <filter>
    <name>MCL Thrust detent R</name>
    <type>gain</type>
    <update-interval-secs type="double">0.0</update-interval-secs>
    <input>
	<expression>
			<table>
				<property>/controls/engines/engine[1]/throttle-int</property>
				<entry><ind> 0 </ind><dep> 0.0</dep></entry>
				<entry><ind> 0.7</ind><dep> 1</dep></entry>
				<entry><ind> 0.8</ind><dep> 1</dep></entry>
			</table>
	</expression>
    </input>
    <enable>
        <condition>
		<and>
			<equals>
				<property>/controls/engines/engine[1]/condition-lever-state</property>
				<value>3</value>
			</equals>
			<less-than-equals>
				<property>/controls/engines/engine[1]/throttle-int</property>
				<value>0.8</value>
			</less-than-equals>
		</and>
        </condition>
    </enable>
    <gain>0.65</gain>
	<output>fcs/throttle-cmd-norm[1]</output>
	<output>fcs/throttle-pos-norm[1]</output>
  </filter>
  
  <!--MCR: Maximum Cruise Power-->
  <!--Condition: Condition Lever in MIN 850 RPM position-->
  <!--Throttle command: 0.62 (pure guess based on figure 12.23-4 in http://www.smartcockpit.com/docs/Q400-Power_Plant.pdf-->
  <filter>
    <name>MCR Thrust detent R</name>
    <type>gain</type>
    <update-interval-secs type="double">0.0</update-interval-secs>
    <input>
	<expression>
			<table>
				<property>/controls/engines/engine[1]/throttle-int</property>
				<entry><ind> 0 </ind><dep> 0.0</dep></entry>
				<entry><ind> 0.7</ind><dep> 1</dep></entry>
				<entry><ind> 0.8</ind><dep> 1</dep></entry>
			</table>
	</expression>
    </input>
    <enable>
        <condition>
		<and>
			<equals>
				<property>/controls/engines/engine[1]/condition-lever-state</property>
				<value>2</value>
			</equals>
			<less-than-equals>
				<property>/controls/engines/engine[1]/throttle-int</property>
				<value>0.8</value>
			</less-than-equals>
		</and>
        </condition>
    </enable>
    <gain>0.62</gain>
	<output>fcs/throttle-cmd-norm[1]</output>
	<output>fcs/throttle-pos-norm[1]</output>
  </filter>
  
  <!--FUEL CUTOFF: no power at all-->
  
  <filter>
    <name>CUTOFF R</name>
    <type>gain</type>
    <update-interval-secs type="double">0.0</update-interval-secs>
    <input>
	    <value>0</value>
    </input>
    <enable>
        <condition>
		<equals>
			<property>/controls/engines/engine[1]/condition-lever-state</property>
			<value>0</value>
		</equals>
        </condition>
    </enable>
    <gain>1</gain>
	<output>fcs/throttle-cmd-norm[1]</output>
	<output>fcs/throttle-pos-norm[1]</output>
  </filter>
  
  
  <!-- DELETE ME! -->
	<pid-controller>
		<name>IAS THR</name>
		<debug>false</debug>
		<enable>
			<condition>
				<and>
					<equals>
						<property>/it-autoflight/input/kts-mach</property>
						<value>0</value>
					</equals>
					<equals>
						<property>/it-autoflight/output/thr-mode</property>
						<value>0</value>
					</equals>
					<equals>
						<property>/it-autoflight/output/athr</property>
						<value>1</value>
					</equals>
				</and>
			</condition>
		</enable>
		<input>
			<property>/instrumentation/airspeed-indicator/indicated-speed-kt</property>
		</input>
		<reference>
			<property>/it-autoflight/input/spd-kts</property>
		</reference>
		<output>
			<property>/controls/engines/engine[0]/throttle</property>
			<property>/controls/engines/engine[1]/throttle</property>
		</output>
		<config>
			<Kp>0.06</Kp>
			<beta>1.0</beta>
			<alpha>0.1</alpha>
			<gamma>0.0</gamma>
			<Ti>10.0</Ti>
			<Td>0.00001</Td>   
			<u_min>0.0</u_min>  
			<u_max>0.77</u_max>  
		</config>
	</pid-controller>
	
	<filter>
		<name>IDLE</name>
		<debug>false</debug>
		<type>gain</type>
		<gain>1</gain>
		<enable>
			<condition>
				<and>
					<equals>
						<property>/it-autoflight/output/thr-mode</property>
						<value>1</value>
					</equals>
					<equals>
						<property>/it-autoflight/output/athr</property>
						<value>1</value>
					</equals>
				</and>
			</condition>
		</enable>
		<input>
			<condition>
				<equals>
					<property>/it-autoflight/mode/thr</property>
					<value>RETARD</value>
				</equals>
			</condition>
			<value>0.0</value>
		</input>
		<input>
			<value>0.01</value>
		</input>
		<output>
			<property>/controls/engines/engine[0]/throttle</property>
			<property>/controls/engines/engine[1]/throttle</property>
		</output>
	</filter>

	<filter>
		<name>CLB</name>
		<debug>false</debug>
		<type>gain</type>
		<gain>1</gain>
		<enable>
			<condition>
				<and>
					<equals>
						<property>/it-autoflight/output/thr-mode</property>
						<value>2</value>
					</equals>
					<equals>
						<property>/it-autoflight/output/athr</property>
						<value>1</value>
					</equals>
				</and>
			</condition>
		</enable>
		<input>
			<value>0.77</value>
		</input>
		<output>
			<property>/controls/engines/engine[0]/throttle</property>
			<property>/controls/engines/engine[1]/throttle</property>
		</output>
	</filter>

</PropertyList>
